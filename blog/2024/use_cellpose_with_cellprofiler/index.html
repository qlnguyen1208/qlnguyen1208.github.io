<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> How to use Cellpose with Cellprofiler (without plugin) | Quan Nguyen </title> <meta name="author" content="Quan Nguyen "> <meta name="description" content="A short tutorial on how cellpose segmentation can be used in cellprofiler pipelines without using the plugin."> <meta name="keywords" content="quan nguyen, loc anh quan nguyen, math, econ, uc san diego, ucsd"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="/assets/libs/mdb/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="/assets/libs/google_fonts/google-fonts.css"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.png?90567cde5ed699449994bc543c53db9f"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://qlnguyen1208.github.io/blog/2024/use_cellpose_with_cellprofiler/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Quan Nguyen</span> </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/index.html">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/news/">news </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publication<del>s</del> </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">How to use Cellpose with Cellprofiler (without plugin)</h1> <p class="post-meta"> Created in March 01, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/python"> <i class="fa-solid fa-hashtag fa-sm"></i> python</a>   <a href="/blog/tag/cellprofiler"> <i class="fa-solid fa-hashtag fa-sm"></i> cellprofiler</a>   <a href="/blog/tag/cellpose"> <i class="fa-solid fa-hashtag fa-sm"></i> cellpose</a>   ·   <a href="/blog/category/tutorials"> <i class="fa-solid fa-tag fa-sm"></i> tutorials</a>   <a href="/blog/category/research"> <i class="fa-solid fa-tag fa-sm"></i> research</a>   <a href="/blog/category/tools"> <i class="fa-solid fa-tag fa-sm"></i> tools</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p><a href="https://www.cellpose.org/" rel="external nofollow noopener" target="_blank">Cellpose</a> is generalist segmentation algorithm that allows for reliable identification of cells in microscope images even under suboptimal conditions (e.g. bad focus, degenerated cells) and its usage in combination with <a href="https://cellprofiler.org/" rel="external nofollow noopener" target="_blank">Cellprofiler</a> enables highly automated analysis of cell/tissue morphology. A <a href="https://forum.image.sc/t/new-cellprofiler-4-plugin-runcellpose/56858" rel="external nofollow noopener" target="_blank">plugin</a> allows for direct integration of the two tools and is the most convenient way to build a pipeline, however for various reasons it can be useful to separate segmentation process and analysis.</p> <p><br></p> <h4 id="0-install-cellpose--cellprofiler">0) Install Cellpose &amp; Cellprofiler</h4> <p>Before starting, make sure you have <a href="https://www.python.org/downloads/" rel="external nofollow noopener" target="_blank">python</a> installed. If you lack permission or don’t want to install software on the system you are working on <a href="https://winpython.github.io/" rel="external nofollow noopener" target="_blank">WinPython</a> offers an easy way to run python from a local folder without installation.</p> <p>Open a PowerShell prompt (when using WinPython run “WinPython Powershell Prompt.exe”) and run the commands below to install Cellpose and it’s optional graphical user interface.</p> <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pip</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="s2">"cellpose"</span><span class="w">
</span><span class="n">pip</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="s2">"cellpose[gui]"</span><span class="w">
</span></code></pre></div></div> <p>To install Cellprofiler you can either download the <a href="https://cellprofiler.org/releases" rel="external nofollow noopener" target="_blank">installer</a> or run the command below in a PowerShell prompt.</p> <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pip</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="s2">"cellprofiler"</span><span class="w">
</span></code></pre></div></div> <blockquote> <h5 id="info">INFO</h5> <p class="block-tip">For this example, I used the, as of this writing, most recent versions of Cellpose 3 and Cellprofiler 4 but future updates might break the exact procedure.</p> </blockquote> <p><br></p> <h4 id="1-segmentation-in-cellpose">1) Segmentation in Cellpose</h4> <p>To start Cellpose in gui mode run <code class="language-plaintext highlighter-rouge">cellpose</code> in a PowerShell prompt. Here you can load single pictures from you dataset and determine the optimal run parameters. You can use the “Calibrate” button after you loaded a picture to determine the average pixel size of your cells. For a more detailed explanation check out the <a href="https://cellpose.readthedocs.io/en/latest/" rel="external nofollow noopener" target="_blank">official documentation.</a></p> <p>Segmenting all of your pictures using the gui can be cumbersome if your dataset has n&gt;1, so the command below can process an entire folder full of pictures and safe the produced masks as png.</p> <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cellpose</span><span class="w"> </span><span class="se">`
</span><span class="nt">--dir</span><span class="w"> </span><span class="s2">"C:\Users\User\Documents\Cellpose\in"</span><span class="w"> </span><span class="se">`
</span><span class="nt">--savedir</span><span class="w"> </span><span class="s2">"C:\Users\User\Documents\Cellpose\out"</span><span class="w"> </span><span class="se">`
</span><span class="nt">--save_png</span><span class="w"> </span><span class="se">`
</span><span class="nt">--chan</span><span class="w"> </span><span class="nx">0</span><span class="w"> </span><span class="se">`
</span><span class="nt">--diameter</span><span class="w"> </span><span class="nx">90</span><span class="w"> </span><span class="se">`
</span><span class="nt">--pretrained_model</span><span class="w"> </span><span class="nx">cyto3</span><span class="w"> </span><span class="se">`
</span><span class="nt">--exclude_on_edges</span><span class="w">
</span></code></pre></div></div> <p>A short explanation of what the flags achieve, for more details check the <a href="https://cellpose.readthedocs.io/en/latest/cli.html" rel="external nofollow noopener" target="_blank">documentation:</a><br> <code class="language-plaintext highlighter-rouge">--dir</code> Choose the folder where your input images are saved<br> <code class="language-plaintext highlighter-rouge">--savedir</code> Choose the folder to which your masks are saved<br> <code class="language-plaintext highlighter-rouge">--save_png</code> Saves the result of the segmentation (=mask) as png file<br> <code class="language-plaintext highlighter-rouge">--chan 0</code> Uses the grey channel for segmentation<br> <code class="language-plaintext highlighter-rouge">--diameter</code> Choose the average diameter of your cells in pixel (can be determined in the gui)<br> <code class="language-plaintext highlighter-rouge">--pretrained_model cyto3</code> Selects the model to use for segmentation, tweak as necessary<br> <code class="language-plaintext highlighter-rouge">--eclude_on_edges</code> Makes sure cells on the edge of the image aren’t segmented<br> If you have a gpu I recommend you add <code class="language-plaintext highlighter-rouge">--use_gpu</code> to significantly speed up the segmentation.</p> <p><br></p> <h4 id="2-analysis-in-cellprofiler">2) Analysis in Cellprofiler</h4> <p>The generated masks can be used in cellprofiler to detect the segmented cells as individual objects. To achieve this, assign your masks in “Images” and “NamesAndTypes” and use the “ConvertImageToObjects” module in your pipeline, select the cellpose masks as input, name your output objects and select “No” on “Convert to boolean image”</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/CellProfiler_ImageToObj-480.webp 480w,/assets/img/CellProfiler_ImageToObj-800.webp 800w,/assets/img/CellProfiler_ImageToObj-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/CellProfiler_ImageToObj.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="CellProfiler Screenshot" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>You can then use the objects in other modules such as “MeasureObjectSizeShape”.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/create-latex-primer-table-from-csv/">Creating a PCR Primer Table in LaTeX from a .csv File</a> </li> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Quan Nguyen . <br> Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme and <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a> <br> <a href="/impressum">Impressum</a> </div> </footer> <script src="/assets/libs/jquery/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="/assets/libs/mdb/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="/assets/libs/masonry/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="/assets/libs/imagesloaded/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="/assets/libs/medium_zoom/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="/assets/libs/mathjax/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?70d799092f862ad98c7876aa47712e20"></script> <script defer src="/assets/libs/polyfill/polyfill.min.js" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> </body> </html>